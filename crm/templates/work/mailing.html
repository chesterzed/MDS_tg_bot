{% extends 'base.html' %}
{% load static %}

{% block main %}
<link rel="stylesheet" href="{% static 'css/work/main.css' %}">

<div class="mainPage">

	<form action="" method="post" enctype="multipart/form-data">


		{% csrf_token %}
		<div class="templateCard">

			{% for us in users %}
			{{ us.tg_id }}
			{% endfor %}
			<table class="table">
				<tbody style="width: 30vw;">
					<tr>
						<td>Название</td>
						<td>
							<input value='{{mailing.name}}' type="text" required name="name" minlength="2" maxlength="1000"
								placeholder="*" class="searchInpt" style="border: 1px solid rgba(142,148,177,.5);">
						</td>
					</tr>
					<tr>
						<td>Описание</td>
						<td>
							<textarea type="text" name="desc" class="searchInpt" placeholder="*" required
								style="border: 1px solid rgba(142,148,177,.5); height: 200px; width: 300px;">{{mailing.desc}}</textarea>
						</td>
					</tr>
					<tr>
						<td>Фото</td>
						<td>
							<input type="file" name="photo" class="searchInptPhoto" id="fileName" required style="border: 0;">
						</td>
					</tr>
					<tr>
						<td>Добавите пользоватля/ей</td>
						<td>
							<a class="buttonM" href="#openModal">Добавить</a>
						</td>
						<div id="openModal" class="modal">
							<div class="modal-dialog">
								<div class="modal-content">
									<div class="modal-header">
										<h3 class="modal-title">Выберите пользователей </h3>
										<a href="#close" title="Close" class="close">×</a>
									</div>
									<div class="modal-body">
										<div class="col">
											<input id="searchForm" class="form-control searchInpt" type="text"
												placeholder="Поиск..." onkeyup="
															var filter = document.getElementById('searchForm').value.toLowerCase();
															var nodes = document.getElementsByClassName('el');
										
															var is_match = false;
							
															var count = nodes.length;
															var viewCount = 0;
							
															for(i = 0; i < nodes.length; i++){
																if (nodes[i].id.toLowerCase().includes(filter)){
																	is_match = true;
																	viewCount++;
																	nodes[i].style.display = 'block';
																} else {
																	nodes[i].style.display = 'none';
																}
															}
							
															var schet = document.getElementById('count');
															schet.innerHTML = 'Показано ' + viewCount.toString() + ' из ' + count.toString();
															">
											<div id="count" style="font-size: 10pt; color: #0e1f4d; display: block; width: 25%;">
											</div>
										</div>
										{% for user in users %}
										<div class="el" id="{{user.phone}}">
											<div class="templateCard">
												<div class="card-body">
													{{user.phone}}





													{% csrf_token %}
													<select name="manage" id="{{user.phone}}"
														style="border: 0;  float: right; transform: scale(1.2); ">
														<option value="true">Да</option>
														<option value="false" selected>Нет</option>
													</select>











												</div>
											</div>
										</div>
										{% endfor %}
									</div>
								</div>
							</div>
						</div>





					</tr>
				</tbody>

			</table>
		</div>


		<a href="{% url 'main' 'mailing' %}"><button class="button" type="button">Назад</button></a>
		<button class="button" type="submit">Сохранить</button>
		{% if mailing %}
		<button class="button" name="delete" type="submit">Удалить</button>
		{% endif %}
	</form>

</div>



</div>
<script>
	document.addEventListener("DOMContentLoaded", function () {
		var scrollbar = document.body.clientWidth - window.innerWidth + 'px';
		console.log(scrollbar);
		document.querySelector('[href="#openModal"]').addEventListener('click', function () {
			document.body.style.overflow = 'hidden';
			document.querySelector('#openModal').style.cssText = "opacity: 1; display: block;";
		});
		document.querySelector('[href="#close"]').addEventListener('click', function () {
			document.body.style.overflow = 'visible';
			document.querySelector('#openModal').style.cssText = "opacity: 0;  display: none;";
		});
	});




	let our = []
	document.querySelectorAll('[name="manage"]').forEach((e) => {
		e.addEventListener('change', (ev) => {
			console.log(e.value)
			console.log(e.value == 'true')
			if (e.value == true) {
				our.push(e.value)
			}
			else {
				if (our.indexOf(e.value) != -1) {
					our.splice(our.indexOf(e.value), 1);
				}
			}
			console.log(our)
		})
	})




	$("input[name='data']").mask('99.99.9999 99:99');
</script>

{% endblock main %}